<mat-drawer-container class="tree-container">
    
    <mat-drawer mode="side" opened class="rare-wind-gradient">

        <mat-accordion>

            <mat-expansion-panel [expanded]="true" (opened)="panelOpenStateTree = true" (closed)="panelOpenStateTree = false">

                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <u>Группы товаров</u>
                    </mat-panel-title>
                    <mat-panel-description>
                    </mat-panel-description>
                </mat-expansion-panel-header>
                <mat-divider class="ml-2 mr-3"></mat-divider>
                <div class="mat-panel-overflow">
                    <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">

                        <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding (click)="onSelectNode(node)"
                            [ngClass]="{ 'select-row': selectedRowTree == node.id }">
            
                            <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.name" (click)="onSelectNode(node)">
            
                                <mat-icon class="mat-icon-rtl-mirror" *ngIf="node.children">
                                    {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                                </mat-icon>
            
                                <label> {{node.name}} </label>
            
                            </button>
                           
                        </mat-tree-node>
            
                        <mat-tree-node  *matTreeNodeDef="let node;when: hasChild" matTreeNodePadding (click)="onSelectNode(node)"  
                            [ngClass]="{ 'select-row': selectedRowTree == node.id }">
            
                            <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.name" (click)="onSelectNode(node)">
            
                                <mat-icon class="mat-icon-rtl-mirror">
                                    {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                                </mat-icon>
                                <label> {{node.name}} </label>
                                
                            </button>
                            
                        </mat-tree-node>
                    </mat-tree>
                </div>
            </mat-expansion-panel>

            <mat-expansion-panel (opened)="panelOpenStateOrdering = true" (closed)="panelOpenStateOrdering = false">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <u>Выписка</u>
                    </mat-panel-title>
                    <mat-panel-description>
                    </mat-panel-description>
                </mat-expansion-panel-header>
                <mat-divider class="ml-2 mr-3"></mat-divider>
                <div class="mat-panel-overflow">
                    <app-product-ordering-list-form [isOpen]="panelOpenStateOrdering" [article]="productArticleOrdering"></app-product-ordering-list-form>
                </div>
                
            </mat-expansion-panel>

            <mat-expansion-panel (opened)="panelOpenStatePrice = true" (closed)="panelOpenStatePrice = false">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <u>Ценники</u>
                    </mat-panel-title>
                    <mat-panel-description>
                    </mat-panel-description>
                </mat-expansion-panel-header>
                <mat-divider class="ml-2 mr-3"></mat-divider>
                <div class="mat-panel-overflow">
                    <app-product-price-list-form [isOpen]="panelOpenStatePrice"  [article]="productArticlePrice"></app-product-price-list-form>
                </div>
            </mat-expansion-panel>

        </mat-accordion>

    </mat-drawer>

    <mat-drawer-content>

        <div class="row m-2 mt-1">

            <div class="col-3">

                <div class="row">
                    <mat-form-field appearance="outline" data-placement="bottom" matTooltip="">
                        <mat-label>Поиск</mat-label>
                        <input matInput placeholder="Введите значение" id="searchValue" name="searchValue" [(ngModel)]="searchValue" (keyup.enter)="onSearch()">
                    </mat-form-field>
                </div>
                <div class="row">
                    <button mat-stroked-button color="primary" class="mr-2" (click)="onSearch()" data-placement="bottom" matTooltip="Применить поиск"> Поиск </button> 
                    <button mat-stroked-button (click)="searchValue = ''" data-placement="bottom" matTooltip="Очистить поле ввода"> Очистить </button> 
                </div>

            </div>
            <div class="col-9">

                <div class="row pl-2 pt-1">
                    <mat-button-toggle-group appearance="legacy" name="fontStyle" aria-label="Font Style" [(ngModel)]="selectedSearchVar" class="bt-font-size">
                        <mat-button-toggle id="but" value="article" data-toggle="tooltip" data-placement="bottom" title="Артикул" matTooltip="Поиск по артикулю">
                            Артикул
                        </mat-button-toggle>
                        <mat-button-toggle value="barcode" data-toggle="tooltip" data-placement="bottom" title="Штрихкод" matTooltip="Поиск по штрихкоду">
                            Штрихкод
                        </mat-button-toggle>
                        <mat-button-toggle value="name" data-toggle="tooltip" data-placement="bottom" title="Наименование" matTooltip="Поиск по наименованию">
                            Наименование
                        </mat-button-toggle>
                    </mat-button-toggle-group>
                </div>

                <div class="row pl-2">
                    <mat-checkbox class="check-bord" [(ngModel)]="isOpenProductPits" data-placement="bottom" matTooltip="Отображение товарных ям">Товарные ямы</mat-checkbox>
                </div>
                
            </div>
        </div>

        <div class="table-container" (scroll)="onScroll($event)" [ngClass]="{'prod': !isOpenProductPits, 'prod-pits': isOpenProductPits }">
            <table mat-table [dataSource]="dataSourceProducts" class="table-hover" #productTable >

                <ng-container matColumnDef="article">
                    <th mat-header-cell *matHeaderCellDef> Артикул </th>
                    <td mat-cell *matCellDef="let element"> {{element.article}} </td>
                </ng-container>

                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef> Наименование </th>
                    <td mat-cell *matCellDef="let element" > {{element.name}} </td>
                </ng-container>

                <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef> Тип </th>
                    <td mat-cell *matCellDef="let element"> {{element.type}} </td>
                </ng-container>     

                <ng-container matColumnDef="goods">
                    <th mat-header-cell *matHeaderCellDef> Остаток </th>
                    <td mat-cell *matCellDef="let element"> {{element.goods}} </td>
                </ng-container>

                <ng-container matColumnDef="price">
                    <th mat-header-cell *matHeaderCellDef> Цена </th>
                    <td mat-cell *matCellDef="let element" > {{element.price}} </td>
                </ng-container>

                <ng-container matColumnDef="action">
                    <th mat-header-cell *matHeaderCellDef>  </th>
                    <td mat-cell *matCellDef="let element; let i = index;"> 
                        <ng-container *ngIf="hoveredIndex == i">
                            <mat-icon id="push" matTooltip="Добавить в выписку" (click)="productArticleOrdering = element.article">add_circle_outline</mat-icon>
                            <mat-icon id="push" matTooltip="Добавить в ценники" (click)="productArticlePrice = element.article">local_atm</mat-icon>
                        </ng-container>
                    </td>
                </ng-container>          
        
                <tr mat-header-row *matHeaderRowDef="displayedColumnsProducts; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumnsProducts; let i = index;"
                    (mouseover)="hoveredIndex = i"
                    (click)="selectedRow.article = row.article"
                    (dblclick)="onOpenProductCard(row)"
                    [ngClass]="{ 'select-row': selectedRow.article == row.article }">
                </tr>
            </table>
        </div>
        <div [hidden]="!isOpenProductPits">
            <mat-divider></mat-divider>
            <app-product-pits [productToAdd]="productToAdd" (clearProductEvent)="clearProduct($event)"></app-product-pits>
        </div>
    </mat-drawer-content>
   
</mat-drawer-container>